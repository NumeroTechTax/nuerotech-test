# Render Blueprint: Tax Reports Portal
# Frontend: tax-reports-web.onrender.com
# Backend:  tax-reports-api.onrender.com

services:
  # Frontend (Next.js)
  - type: web
    name: tax-reports-web
    runtime: node
    rootDir: client
    buildCommand: npm install && npm run build
    startCommand: npm start
    envVars:
      - key: NEXT_PUBLIC_APP_URL
        value: https://tax-reports-web.onrender.com
      - key: NEXT_PUBLIC_API_URL
        value: https://tax-reports-api.onrender.com
    healthCheckPath: /

  # Backend (Node/Express API)
  - type: web
    name: tax-reports-api
    runtime: node
    rootDir: backend
    buildCommand: npm install && npm run build
    startCommand: npm start
    preDeployCommand: npx prisma migrate deploy
    envVars:
      - key: FRONTEND_URL
        value: https://tax-reports-web.onrender.com
      - key: DATABASE_URL
        sync: false
      - key: JWT_SECRET
        sync: false
    healthCheckPath: /health
